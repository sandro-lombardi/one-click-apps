captainVersion: 4
services:
    $$cap_appname:
        caproverExtra:
            dockerfileLines:
                - FROM litestream/litestream:$$cap_version
                - CMD replicate $$cap_db_path $$cap_bucket_url
            notExposeAsWebApp: 'true'
        volumes:
            - $$cap_appname-data:/data
        environment:
            - LITESTREAM_ACCESS_KEY_ID: $$cap_access_key_id
            - LITESTREAM_SECRET_ACCESS_KEY: $$cap_secret_access_key
caproverOneClickApp:
    variables:
        - id: '$$cap_version'
          label: Litestream Version
          defaultValue: 'latest'
          description: Check out their Docker page for the valid tags https://hub.docker.com/r/litestream/litestream/tags
          validRegex: "/^([^\\s^\\/])+$/"
        - id: '$$cap_access_key_id'
          label: Access Key ID
          defaultValue: ''
          description: Enter your Access Key ID
        - id: '$$cap_secret_access_key'
          label: Secret Access Key
          defaultValue: ''
          description: Enter your Secret Access Key
        - id: '$$cap_db_path'
          label: Database path within containter
          defaultValue: '/data/db'
          description: Enter the databaset path within the container
        - id: '$$cap_bucket_url'
          label: S3 bucket URL
          defaultValue: 's3://BUCKET/db'
          description: Enter your S3 bucket URL

    instructions:
        start: |-
            This one-click app will deploy a litestream service that streams your SQLite3 database to an S3 bucket.
            To use this app, you need to enter your S3 credentials (Access Key ID and Secret Access Key).
        end: |-
            Your litestream service has been deployed successfully!
    displayName: Litestream
    isOfficial: true
    description: Streaming replication for SQLite
    documentation: https://github.com/benbjohnson/litestream
